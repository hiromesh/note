## 原则一：关注于真正的收益而不是技术本身

- **是否可以降低技术门槛加快整个团队的开发流程**。系统架构需要能够进行并行开发，并行上线和并行运维，而不会让某个团队成为瓶颈点。
- **是否可以让整个系统可以运行的更稳定**。要让整个系统可以运行的更为的稳定，提升整个系统的 SLA，就需要对有计划和无计划的**停机**做相应的解决方案。
- **是否可以通过简化和自动化降低成本**。最高优化的成本是人力成本，人的成本除了慢和贵，还有经常不断的 human error。

## 原则二：以应用服务和 API 为视角，而不是资源和技术

**所谓 DevOps，其实就是因为很多技术和组件已经分不清是 Dev 还是 Ops 的了，所以，需要合并 Dev和 Ops**。

整个组织和架构的优化，已经不能通过调优单一分工或是单一组件来获得较大提升。需要有一种自顶向下的，整体规划，统一设计的方式，才能做到整体的提升（可以试想一下城市交通的优化，当城市规模到一定程度的时候，整体的性能你是无法通过优化几条路或是几条街区来完成的，你需要对整个城市做整体的功能体的规划才可能达到整体效率的提升）。

为了做到整体的提升，需要所有的人都要有一个统一的视角和目标，这个目标就是——**要站在服务和 对外API的视角来看问题，而不是技术和底层的角度。**

## 原则三：选择最主流和成熟的技术

- **尽可能的使用更为成熟更为工业化的技术栈**。 所谓工业化的技术栈，你可以看看大多数公司使用的技术栈，比如：互联网，金融，电信……等等 ，大公司会有更多的技术投入，也需要更大规模的生产，所以，他们使用的技术通常来说都是比较工业化的。
- **选择全球流行的技术，而不是中国流行的技术**。技术是一个全球化的东西，只有普世性的技术有更强的生命力。
- **尽可能的使用红利大的主流技术，而不要发明轮子，更不要魔改**。这个时代是要想尽方法跟整个产业，整个技术社区融合和合作，这样才会有最大的收益。
- **绝大多数情况下，如无非常特殊要求，选 Java基本是不会错的**。一方面，这是因为 Java 的业务开发的生产力是非常好的，而且有 Spring 框架保障，代码很难写烂，另外，Java 的社区太成熟了，你需要的各种架构和技术都可以很容易获得，技术红利实在是太大。

## 原则四：完备性会比性能更重要

- **使用最科学严谨的技术模型为主，并以不严谨的模型作为补充**。永远使用完备支持 ACID 的关系型数据库，然后用 NoSQL 作补充。这里的原则就是所谓的“先紧后松”。

- **性能上的东西，总是有很多解的**。

## 原则五：制定并遵循服从标准、规范和最佳实践

- **服务间调用的协议标准和规范**。包括 Restful API路径, HTTP 方法、状态码、标准头、自定义头等，返回数据 json Scheme……等。

- **命名的标准和规范**。如：用户 ID，服务名、标签名、状态名、错误码、消息、数据库……等等

- **日志和监控的规范**。日志格式，监控数据，采样要求，报警……等等

- **配置上的规范**。这其中包括：操作系统配置、中间件配置，软件包……等等

- **中间件使用的规范**。数据库，缓存、消息队列……等等

- **软件和开发库版本统一**。整个组织架构内，软件或开发库的版本最好每年都升一次级，然后在各团队内统一。

- **Restful API 的规范**。可参考 [Microsoft](https://github.com/microsoft/api-guidelines) 。Restful API 有一个标准和规范最大的好处就是监视可以很容易地做各种统计分析，控制系统可以很容易的做流量编排和调度。

- **服务调用链追踪**。服务调用链追踪基本上都是参考于 [Google Dapper](https://research.google/pubs/pub36356/) 这篇论文，最严格的实现是 [Zipkin](https://zipkin.io/)，这也是 Spring Cloud Sleuth 的底层实现。Zipkin 贴近 Google Dapper 论文的好处在于——无状态，快速地把 Span 发出来，不消耗服务应用侧的内存和 CPU。这意味着，监控系统宁可自己死了也不能干扰实际应用。

- **软件升级**。一个公司至少一年要有一次软件版本升级的review，然后形成软件版本的统一和一致，这样会极太简化系统架构的复杂度。

## 原则六：重视架构扩展性和可运维性

80%的软件成本都是在维护上。所谓的扩展性，意味着，我可以很容易地加更多的功能，或是加入更多的系统，而所谓可运维，就是说我可以对线上的系统做任意的变更。扩展性要求的是有标准规范且不耦合的业务架构，可运维性要求的则是可控的能力，也就是一组各式各样的控制系统。

- **通过服务编排架构来降低服务间的耦合**。比如：通过一个业务流程的专用服务，或是像 Workflow，Event Driven Architecture ， Broker，Gateway，Service Discovery 等这类的的中间件来降低服务间的依赖关系。

- **通过服务发现或服务网关来降低服务依赖所带来的运维复杂度**。服务发现可以很好的降低相关依赖服务的运维复杂度，让你可以很轻松的上线或下线服务，或是进行服务伸缩。

- **使用各种软件设计的原则**。比如：像SOLID这样的原则（参看《[一些软件设计的原则](https://coolshell.cn/articles/4535.html)》），IoC/DIP，SOA 或 Spring Cloud 等 架构的最佳实践（参看《[SteveY对Amazon和Google平台的吐槽](https://coolshell.cn/articles/5701.html)》中的 Service Interface 的那几条军规），分布式系统架构的相关实践（参看：《[分布式系统的事务处理](https://coolshell.cn/articles/10910.html)》，或微软件的 《[Cloud Design Patterns](https://docs.microsoft.com/en-us/azure/architecture/patterns/)》）……等等

## 原则七：对控制逻辑进行全面收口

- **流量收口**。流量的调度，主要通过流量网关，开发框架 SDK或 Service Mesh 这样的技术。
- **服务治理收口**。包括：服务发现、健康检查，配置管理、事务、事件、重试、熔断、限流……主要通过开发框架 SDK – 如：Spring Cloud，或服务网格Service Mesh等技术。
- **监控数据收口**。包括：日志、指标、调用链……主要通过一些标准主流的探针，再加上后台的数据清洗和数据存储来完成，最好是使用无侵入式的技术。监控的数据必须统一在一个地方进行关联，这样才会产生信息。
- **资源调度有应用部署的收口**。包括：计算、网络和存储的收口，主要是通过容器化的方案，如k8s来完成。
- **中间件的收口**。包括：数据库，消息，缓存，服务发现，网关……等等。这类的收口方式一般要在企业内部统一建立一个共享的云化的中间件资源池。

对此，这里的原则是：

- **选择容易进行业务逻辑和控制逻辑分离的技术**。例如Java 的 JVM+字节码注入+AOP 式的Spring 开发框架。
- **享受“前人种树，后人乘凉”的有技术红利的技术**。如：有庞大社区而且相互兼容的技术，如：Java, Docker, Ansible，HTTP，Telegraf/Collectd……
- **中间件使用支持HA集群和多租户的技术**。

## 原则八：不要迁就老旧系统的技术债务

- **与其花大力气迁就技术债务，不如直接还技术债。是所谓的长痛不如短痛。**
- **建设没有技术债的“新城区”，并通过“[防腐层](https://docs.microsoft.com/en-us/azure/architecture/patterns/anti-corruption-layer) ”的架构模型，不要让技术债侵入“新城区”**。

## 原则九：不要依赖自己的经验，要依赖于数据和学习

- 如果有一天你在做技术决定的时候，开始凭自己以往的经验，那么你就已经不可能再成长了。

- 人都是不可能通过不断重复过去而进步的，人的进步从来都是通过学习自己不知道的东西。做任何决定之前，最好花上一点时间，上网查一下相关的资料，技术博客，文章，论文等 ，同时，也看看各个公司，或是各个开源软件他们是怎么做的？然后，比较多种方案的 Pros/Cons，最终形成自己的决定，这样，才可能做出一个更好的决定。

## 原则十：千万要小心 X – Y 问题，要追问原始需求

对于 [X-Y 问题](https://coolshell.cn/articles/10804.html)，也就是说，用户为了解决 X问题，他觉得用 Y 可以解，于是问我 Y 怎么搞，结果搞到最后，发现原来要解决的 X 问题，这个时候最好的解决方案不是 Y，而是 Z。 这种 X-Y 问题真是相当之多，见的太多太多了。所以，每次用户来找我的时候，我都要不断地追问什么是 X 问题。

## 原则十一：激进胜于保守，创新与实用并不冲突

激进并不是瞎搞，也不是见新技术就上，而是积极拥抱会改变未来的新技术，如：Docker/Go。

有一些人会跟我说，我们是实用主义，我们不需要创新，能解决当下的问题就好，所以，我们不需要新技术，现有的技术用好就行了。这类的公司，他们的技术设计第一天就在负债，虽然可以解决当下问题，但是马上就会出现新的问题，然后他们会疲于解决各种问题。最后呢，最后还是会走到新的技术上。

**进步永远来自于探索，探索是要付出代价的，但是收益更大**。

不敢冒险才是最大的冒险，不敢犯错才是最大的错误。